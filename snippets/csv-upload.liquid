<style>
:root {
   --main-bg-color: {{ settings.color_primary }};
   --main-color: {{ settings.color_nav_text }};
   --hover-brightness: 1.2;
}

.filepond--drop-label {
	color:  var(--main-color)
}

.filepond--panel-root {
  background-color: var(--main-bg-color);
}


.filepond--root {
	margin: 0 auto;
}

.filepond--root:hover {
  filter: brightness(var(--hover-brightness));
}
</style>


{%- if section.settings.api_key != blank -%}
{%- endif -%}

{% assign server_address = "https://api.wp-dataanalytics.de/shopify/csvupload" %}

<div>
<div class="wp-upload--wrapper " id="wpaa5822d2">
      <input id='wp-upload' type="file" class="filepond" name="file" accept=".csv"/>
    </label>  
</div>
<p>{{section.settings.message }} <span><a href="{{'csv_orders.csv' | file_url }}" download>{{section.settings.download}}</a></span></p>
</div>
<script>
  
function addToCart(data){
    fetch('/cart/add.js', {
          method: 'POST',
          headers: {
             'Content-Type': 'application/json'
          },
          body: data
})
.then(response => response.json())
.then(setTimeout(()=>location.href='/cart',3000))
.catch((error) => {
  console.error('Error:', error);
   });
  }
 
document.addEventListener('FilePond:loaded', e => {

FilePond.create(
	document.getElementById('wp-upload'),
	{
		labelIdle: "{{ section.settings.labelIdle }}",
    labelFileProcessing: "{{ section.settings.labelFileProcessing }}",
    labelFileProcessingComplete: "{{ section.settings.labelFileProcessingComplete }}",
    labelFileProcessingAborted: "{{ section.settings.labelFileProcessingAborted }}",
    labelFileProcessingError: "{{ section.settings.labelFileProcessingError }}",
	}
);
FilePond.setOptions({
server:{
    url: '{{ server_address }}',
    process: {
      url:'/orders/',
      onload: (response)=>{addToCart(response)}
    },
    revert: null,
    fetch: null
}});
});
</script>
